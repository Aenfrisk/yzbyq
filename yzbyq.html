<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®‡å®™è¯­ç¼–è¯‘å™¨</title>
    <style>
        :root {
            --bg-color: #f5f5f5;
            --text-color: #333;
            --panel-bg: #fff;
            --border-color: #ddd;
            --button-bg: #4a6fa5;
            --button-hover: #3a5a80;
            --button-text: #fff;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --error-color: #dc3545;
            --accent-color: #6c63ff;
        }

        [data-theme="dark"] {
            --bg-color: #222;
            --text-color: #eee;
            --panel-bg: #333;
            --border-color: #555;
            --button-bg: #5a7fa5;
            --button-hover: #4a6a90;
            --success-color: #3dbb61;
            --warning-color: #e9b436;
            --error-color: #e25c6c;
            --accent-color: #8a85ff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        h1 {
            margin: 0;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .theme-toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .theme-label {
            font-size: 14px;
            font-weight: 500;
        }

        .theme-icon {
            font-size: 20px;
            transition: transform 0.3s;
        }

        .theme-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--accent-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .description {
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--panel-bg);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .expandable {
            margin-top: 15px;
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
        }

        .expand-toggle {
            background: none;
            border: none;
            color: var(--accent-color);
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 0;
        }

        .expand-toggle:hover {
            text-decoration: underline;
        }

        .expand-icon {
            transition: transform 0.3s;
        }

        .expanded .expand-icon {
            transform: rotate(180deg);
        }

        .expand-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .expanded .expand-content {
            max-height: 1000px;
        }

        .author {
            margin-top: 15px;
            font-style: italic;
            text-align: right;
            color: var(--accent-color);
            font-weight: 500;
        }

        .panel {
            background-color: var(--panel-bg);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            margin-top: 0;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            color: var(--text-color);
        }

        textarea {
            width: 100%;
            min-height: 150px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--panel-bg);
            color: var(--text-color);
            font-family: 'Courier New', monospace;
            resize: vertical;
            box-sizing: border-box;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 16px;
            background-color: var(--button-bg);
            color: var(--button-text);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        button:hover {
            background-color: var(--button-hover);
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        button.success {
            background-color: var(--success-color);
        }

        button.warning {
            background-color: var(--warning-color);
            color: #333;
        }

        .info-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .info-item {
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: 6px;
            border-left: 4px solid var(--button-bg);
        }

        .info-label {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .info-value {
            font-family: monospace;
            font-size: 18px;
            font-weight: bold;
        }

        .flex-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .flex-container > div {
            flex: 1;
            min-width: 300px;
        }

        .status {
            padding: 10px 12px;
            border-radius: 4px;
            margin-top: 10px;
            display: none;
            font-weight: 500;
        }

        .status.success {
            background-color: rgba(40, 167, 69, 0.2);
            color: var(--success-color);
            display: block;
            border-left: 4px solid var(--success-color);
        }

        .status.error {
            background-color: rgba(220, 53, 69, 0.2);
            color: var(--error-color);
            display: block;
            border-left: 4px solid var(--error-color);
        }

        .cosmic-chars {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.03);
            border-radius: 6px;
        }

        .cosmic-char {
            font-size: 24px;
            padding: 5px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--panel-bg);
            text-align: center;
            min-width: 40px;
        }

        @media (max-width: 768px) {
            .flex-container {
                flex-direction: column;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .theme-toggle-container {
                align-self: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸŒŒ å®‡å®™è¯­ç¼–ç /è§£ç å™¨</h1>
            <div class="theme-toggle-container">
                <span class="theme-label">æµ…è‰²</span>
                <span class="theme-icon">â˜€ï¸</span>
                <label class="theme-switch">
                    <input type="checkbox" id="theme-toggle">
                    <span class="slider"></span>
                </label>
                <span class="theme-icon">ğŸŒ™</span>
                <span class="theme-label">æ·±è‰²</span>
            </div>
        </header>

        <div class="description">
            <p>è¿™æ˜¯ä¸€ä¸ªå®‡å®™è¯­ç¼–ç /è§£ç å·¥å…·ã€‚</p>
            
            <div class="expandable">
                <button class="expand-toggle" id="expand-btn">
                    <span>å·¥ä½œåŸç†ä»‹ç»</span>
                    <span class="expand-icon">â–¼</span>
                </button>
                <div class="expand-content">
                    <h3>å®‡å®™è¯­ç¼–ç åŸç†</h3>
                    <p>å®‡å®™è¯­æ˜¯ä¸€ç§åŸºäºUnicodeå­—ç¬¦çš„ç¼–ç ç³»ç»Ÿï¼Œä½¿ç”¨16ä¸ªç‰¹æ®Šæ–¹å—å­—ç¬¦æ¥è¡¨ç¤º4ä½æ•°æ®(nibble)ã€‚</p>
                    
                    <h4>ç¼–ç è¿‡ç¨‹ï¼š</h4>
                    <ol>
                        <li>å°†è¾“å…¥æ–‡æœ¬çš„æ¯ä¸ªå­—ç¬¦è½¬æ¢ä¸ºUnicodeç¼–ç </li>
                        <li>å¯¹äºASCIIå­—ç¬¦(0-127)ï¼Œä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º0x00</li>
                        <li>å¯¹äºä¸­æ–‡å­—ç¬¦ï¼Œä½¿ç”¨å®Œæ•´çš„Unicodeç¼–ç (ä¸¤ä¸ªå­—èŠ‚)</li>
                        <li>å°†æ¯ä¸ªå­—èŠ‚æ‹†åˆ†ä¸ºä¸¤ä¸ª4ä½æ•°æ®(nibble)</li>
                        <li>å°†æ¯ä¸ªnibbleæ˜ å°„åˆ°å¯¹åº”çš„å®‡å®™è¯­å­—ç¬¦</li>
                        <li>ç”Ÿæˆæ ¡éªŒå’Œå­—ç¬¦å¹¶é™„åŠ åˆ°ç¼–ç ç»“æœä¸­</li>
                    </ol>
                    
                    <h4>è§£ç è¿‡ç¨‹ï¼š</h4>
                    <ol>
                        <li>å°†å®‡å®™è¯­å­—ç¬¦è½¬æ¢å›nibbleå€¼</li>
                        <li>æ¯5ä¸ªå­—ç¬¦ä¸ºä¸€ç»„(4ä¸ªæ•°æ®å­—ç¬¦ + 1ä¸ªæ ¡éªŒå­—ç¬¦)</li>
                        <li>éªŒè¯æ ¡éªŒå’Œç¡®ä¿æ•°æ®å®Œæ•´æ€§</li>
                        <li>å°†nibbleé‡æ–°ç»„åˆä¸ºå­—èŠ‚æ•°æ®</li>
                        <li>æ ¹æ®å­—ç¬¦ç±»å‹(ASCIIæˆ–ä¸­æ–‡)é‡å»ºåŸå§‹æ–‡æœ¬</li>
                    </ol>
                    
                    <p>è¿™ç§ç¼–ç æ–¹å¼è™½ç„¶ä¼šæ˜¾è‘—å¢åŠ æ•°æ®å¤§å°(çº¦2.5å€)ï¼Œä½†åˆ›é€ äº†è§†è§‰ä¸Šç‹¬ç‰¹çš„"å®‡å®™è¯­"æ•ˆæœã€‚</p>
                </div>
            </div>
            
            <div class="author">ä½œè€…: Aenfrisk/è·å…°çƒˆé©¬</div>

            <div class="cosmic-chars">
                <div class="cosmic-char">â–“</div>
                <div class="cosmic-char">â–—</div>
                <div class="cosmic-char">â––</div>
                <div class="cosmic-char">â–„</div>
                <div class="cosmic-char">â–</div>
                <div class="cosmic-char">â–</div>
                <div class="cosmic-char">â–</div>
                <div class="cosmic-char">â–Ÿ</div>
                <div class="cosmic-char">â–˜</div>
                <div class="cosmic-char">â–š</div>
                <div class="cosmic-char">â–Œ</div>
                <div class="cosmic-char">â–™</div>
                <div class="cosmic-char">â–€</div>
                <div class="cosmic-char">â–œ</div>
                <div class="cosmic-char">â–›</div>
                <div class="cosmic-char">â–ˆ</div>
            </div>
        </div>

        <div class="flex-container">
            <div>
                <div class="panel">
                    <h2>ç¼–ç </h2>
                    <textarea id="encode-input" placeholder="è¾“å…¥è¦ç¼–ç çš„æ–‡æœ¬..."></textarea>
                    <div class="button-group">
                        <button id="encode-btn">ç¼–ç </button>
                        <button id="clear-encode" class="warning">æ¸…ç©º</button>
                        <button id="copy-encode">å¤åˆ¶ç»“æœ</button>
                    </div>
                    <div id="encode-status" class="status"></div>
                    <textarea id="encode-output" readonly placeholder="ç¼–ç ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
                </div>
            </div>

            <div>
                <div class="panel">
                    <h2>è§£ç </h2>
                    <textarea id="decode-input" placeholder="è¾“å…¥è¦è§£ç çš„å®‡å®™è¯­..."></textarea>
                    <div class="button-group">
                        <button id="decode-btn">è§£ç </button>
                        <button id="clear-decode" class="warning">æ¸…ç©º</button>
                        <button id="copy-decode">å¤åˆ¶ç»“æœ</button>
                    </div>
                    <div id="decode-status" class="status"></div>
                    <textarea id="decode-output" readonly placeholder="è§£ç ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
                </div>
            </div>
        </div>

        <div class="panel">
            <h2>å¤„ç†ä¿¡æ¯</h2>
            <div class="info-panel">
                <div class="info-item">
                    <div class="info-label">è¾“å…¥å­—ç¬¦æ•°</div>
                    <div class="info-value" id="input-chars">0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">è¾“å‡ºå­—ç¬¦æ•°</div>
                    <div class="info-value" id="output-chars">0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">å¤„ç†æ—¶é—´</div>
                    <div class="info-value" id="process-time">0 ms</div>
                </div>
                <div class="info-item">
                    <div class="info-label">å¤„ç†ç±»å‹</div>
                    <div class="info-value" id="process-type">æ— </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcons = document.querySelectorAll('.theme-icon');
        const themeLabels = document.querySelectorAll('.theme-label');
        const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
        
        // æ£€æŸ¥æœ¬åœ°å­˜å‚¨æˆ–ç³»ç»Ÿåå¥½
        const currentTheme = localStorage.getItem('theme') || 
                            (prefersDarkScheme.matches ? 'dark' : 'light');
        
        // æ›´æ–°ä¸»é¢˜å›¾æ ‡å’Œæ ‡ç­¾
        function updateThemeIcons(isDark) {
            themeIcons.forEach(icon => {
                icon.textContent = isDark ? 'ğŸŒ™' : 'â˜€ï¸';
            });
            themeLabels.forEach(label => {
                label.textContent = isDark ? 'æ·±è‰²' : 'æµ…è‰²';
            });
        }
        
        if (currentTheme === 'dark') {
            document.body.setAttribute('data-theme', 'dark');
            themeToggle.checked = true;
            updateThemeIcons(true);
        } else {
            updateThemeIcons(false);
        }
        
        themeToggle.addEventListener('change', function() {
            if (this.checked) {
                document.body.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                updateThemeIcons(true);
            } else {
                document.body.removeAttribute('data-theme');
                localStorage.setItem('theme', 'light');
                updateThemeIcons(false);
            }
        });

        // æŠ˜å /å±•å¼€åŠŸèƒ½
        const expandBtn = document.getElementById('expand-btn');
        const expandable = expandBtn.parentElement;
        
        expandBtn.addEventListener('click', function() {
            expandable.classList.toggle('expanded');
        });

        // å®‡å®™è¯­å­—ç¬¦æ˜ å°„
        const COSMIC_CHARS = [
            'â–“', // 0x0, U+2593
            'â–—', // 0x1, U+2597
            'â––', // 0x2, U+2596
            'â–„', // 0x3, U+2584
            'â–', // 0x4, U+259D
            'â–', // 0x5, U+2590
            'â–', // 0x6, U+259E
            'â–Ÿ', // 0x7, U+259F
            'â–˜', // 0x8, U+2598
            'â–š', // 0x9, U+259A
            'â–Œ', // 0xa, U+258D
            'â–™', // 0xb, U+2580
            'â–€', // 0xc, U+259C
            'â–œ', // 0xd, U+259B
            'â–›', // 0xe, U+2599
            'â–ˆ', // 0xf, U+2588
        ];

        // å·¥å…·å‡½æ•°
        function byteToNibbles(byte) {
            return [(byte >> 4) & 0xF, byte & 0xF];
        }

        function generateChecksum(nibbles, type) {
            let xor = 0;
            for (const n of nibbles) {
                xor ^= n;
            }
            xor ^= type;
            const parity = (xor.toString(2).split('1').length - 1) % 2;
            const low3 = xor & 0x7;
            return (parity << 3) | low3;
        }

        function validateChecksum(nibbles, type, checksumReceived) {
            return generateChecksum(nibbles, type) === checksumReceived;
        }

        // ä¿®å¤çš„ç¼–ç å‡½æ•° - åŸºäºè§£ç å™¨é€†å‘å®ç°
        function cosmicEncode(text) {
            const output = [];
            
            for (let i = 0; i < text.length; i++) {
                const charCode = text.charCodeAt(i);
                let bytes, charType;
                
                // åˆ¤æ–­å­—ç¬¦ç±»å‹ï¼šASCII(0)æˆ–ä¸­æ–‡å­—ç¬¦(1)
                if (charCode < 128) {
                    // ASCIIå­—ç¬¦
                    bytes = [0x00, charCode];
                    charType = 0;
                } else {
                    // ä¸­æ–‡å­—ç¬¦ - ä½¿ç”¨å®Œæ•´çš„Unicodeç¼–ç 
                    // å°†Unicodeå­—ç¬¦è½¬æ¢ä¸ºæ¨¡æ‹Ÿçš„GB2312ç¼–ç 
                    const code = charCode;
                    bytes = [code >> 8, code & 0xFF];
                    charType = 1;
                }
                
                const nibbles = [];
                for (const b of bytes) {
                    const [h, l] = byteToNibbles(b);
                    nibbles.push(h, l);
                }
                
                const checksum = generateChecksum(nibbles, charType);
                
                for (const n of nibbles) {
                    output.push(COSMIC_CHARS[n]);
                }
                
                output.push(COSMIC_CHARS[checksum]);
            }
            
            return output.join('');
        }

        // è§£ç å‡½æ•° - ä¿æŒä¸å˜
        function cosmicDecode(cosmic) {
            const output = [];
            const nibbles = [];
            
            // å°†å®‡å®™è¯­å­—ç¬¦è½¬æ¢ä¸ºnibbleå€¼
            for (const char of cosmic) {
                const index = COSMIC_CHARS.indexOf(char);
                if (index !== -1) {
                    nibbles.push(index);
                }
            }
            
            let i = 0;
            while (i + 4 < nibbles.length) {
                const currentNibbles = nibbles.slice(i, i + 5);
                const dataNibbles = currentNibbles.slice(0, 4);
                const checksum = currentNibbles[4];
                
                // å°è¯•ASCIIç±»å‹
                const validAscii = validateChecksum(dataNibbles, 0, checksum);
                if (validAscii && dataNibbles[0] === 0 && dataNibbles[1] === 0) {
                    const byte = (dataNibbles[2] << 4) | dataNibbles[3];
                    if (byte >= 32 && byte <= 126) {
                        output.push(String.fromCharCode(byte));
                        i += 5;
                        continue;
                    }
                }
                
                // å°è¯•ä¸­æ–‡ç±»å‹
                const validChinese = validateChecksum(dataNibbles, 1, checksum);
                if (validChinese) {
                    const byte1 = (dataNibbles[0] << 4) | dataNibbles[1];
                    const byte2 = (dataNibbles[2] << 4) | dataNibbles[3];
                    
                    // å°è¯•æ„é€ ä¸­æ–‡å­—ç¬¦
                    try {
                        // ä½¿ç”¨å®Œæ•´çš„Unicodeç¼–ç 
                        const charCode = (byte1 << 8) | byte2;
                        if (charCode > 0x7F) {
                            output.push(String.fromCharCode(charCode));
                            i += 5;
                            continue;
                        }
                    } catch (e) {
                        // è§£ç å¤±è´¥ï¼Œç»§ç»­å°è¯•
                    }
                }
                
                // æ ¡éªŒå¤±è´¥ï¼Œæ»‘åŠ¨çª—å£å‰è¿›1ä½
                i++;
            }
            
            return output.join('');
        }

        // DOMæ“ä½œå’Œäº‹ä»¶å¤„ç†
        document.getElementById('encode-btn').addEventListener('click', function() {
            const input = document.getElementById('encode-input').value;
            const startTime = performance.now();
            
            try {
                const encoded = cosmicEncode(input);
                document.getElementById('encode-output').value = encoded;
                
                const endTime = performance.now();
                updateInfoPanel(input.length, encoded.length, endTime - startTime, 'ç¼–ç ');
                
                showStatus('encode-status', 'ç¼–ç æˆåŠŸ!', 'success');
            } catch (error) {
                showStatus('encode-status', 'ç¼–ç é”™è¯¯: ' + error.message, 'error');
            }
        });

        document.getElementById('decode-btn').addEventListener('click', function() {
            const input = document.getElementById('decode-input').value;
            const startTime = performance.now();
            
            try {
                const decoded = cosmicDecode(input);
                document.getElementById('decode-output').value = decoded;
                
                const endTime = performance.now();
                updateInfoPanel(input.length, decoded.length, endTime - startTime, 'è§£ç ');
                
                showStatus('decode-status', 'è§£ç æˆåŠŸ!', 'success');
            } catch (error) {
                showStatus('decode-status', 'è§£ç é”™è¯¯: ' + error.message, 'error');
            }
        });

        document.getElementById('clear-encode').addEventListener('click', function() {
            document.getElementById('encode-input').value = '';
            document.getElementById('encode-output').value = '';
            document.getElementById('encode-status').className = 'status';
            resetInfoPanel();
        });

        document.getElementById('clear-decode').addEventListener('click', function() {
            document.getElementById('decode-input').value = '';
            document.getElementById('decode-output').value = '';
            document.getElementById('decode-status').className = 'status';
            resetInfoPanel();
        });

        document.getElementById('copy-encode').addEventListener('click', function() {
            const output = document.getElementById('encode-output');
            output.select();
            document.execCommand('copy');
            showStatus('encode-status', 'å·²å¤åˆ¶åˆ°å‰ªè´´æ¿!', 'success');
        });

        document.getElementById('copy-decode').addEventListener('click', function() {
            const output = document.getElementById('decode-output');
            output.select();
            document.execCommand('copy');
            showStatus('decode-status', 'å·²å¤åˆ¶åˆ°å‰ªè´´æ¿!', 'success');
        });

        function updateInfoPanel(inputChars, outputChars, processTime, processType) {
            document.getElementById('input-chars').textContent = inputChars;
            document.getElementById('output-chars').textContent = outputChars;
            document.getElementById('process-time').textContent = processTime.toFixed(2) + ' ms';
            document.getElementById('process-type').textContent = processType;
        }

        function resetInfoPanel() {
            updateInfoPanel(0, 0, 0, 'æ— ');
        }

        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
            
            // 3ç§’åéšè—çŠ¶æ€æ¶ˆæ¯
            setTimeout(() => {
                element.className = 'status';
            }, 3000);
        }

        // åˆå§‹åŒ–ç¤ºä¾‹æ–‡æœ¬
        document.getElementById('encode-input').value = "ä½ å¥½ï¼Œä¸–ç•Œï¼Hello, World! 123";
    </script>
</body>
</html>